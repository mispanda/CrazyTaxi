<style>
    .radio_box li  {
        display: block;
        float: left;
        margin-right:10px;
    }

    .radio_box li label {
        margin-left:5px;
    }

    .text-input1 {
        border-radius:0;
        display: block;
        width: calc(100% - 40px);
        float: left;
    }

    .text-input2 {
        border-radius:0;
        display: block;
        width: calc(100% - 90px);
        float: left;
    }

    .text-input {
        border-radius:0;
        display: block;
        width: 100%;
    }

    .submit_btn {
        background-color: rgba(24,103,194,0.81);
        border: 0;
        font-size: 16px;
        font-weight: 500;
        line-height: 36px;
        padding: 4px 12px;
        display: block;
        width: 100%;
        text-align: center;
        color: #FFF;
    }
    .wickedpicker{
        position: absolute !important;
        left: 0 !important;
        right: 0 !important;
    }

    .marker {
        height: 30px;
        width: 20px;
        margin: 0 10px;
        float: left;
    }

    .right_btn {
        height: 30px;
        line-height: 23px;
        width: 83px;
        margin: 0;
        padding:0;
        float: right;
    }
    
    .left_btn {
        height: 30px;
        line-height: 23px;
        width: 83px;
        margin: 0;
        padding:0;
    }

    input[type="text"] {
        border: #aaa 1px solid;
    }

    .sw-center {
        text-align:center;
    }
</style>


<ons-page style="background:#fff;">
    
    <ons-toolbar fixed-style>
        <div class="left" style="line-height: 44px;">
            <ons-back-button></ons-back-button>
        </div>
        <div class="center">
            <img src="images/go2gether.png" style="height:32px;"/>
        </div>
        <div class="right" style="line-height: 44px">
            <ons-toolbar-button ng-click="menu.toggleMenu()">
                <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>
        	</ons-toolbar-button>
        </div>
    </ons-toolbar>
      
    <div style="clear:both; height:10px"></div>

    <div class="container">

        <ul class="nav nav-tabs">
            <li id="order_airport_tab" style="width:50%;"><a id="airport_btn" data-toggle="tab" href="#airport">機場共乘</a></li>
            <li id="order_normal_tab" class="active"style="width:50%;"><a id="normal_btn" data-toggle="tab" href="#normal">一般共乘</a></li>
        </ul>

        <div class="tab-content">

            <!-- 機場共乘 begin -->
            <div id="airport" class="tab-pane fade">

                <form id="airport_add" action="#">

                    <section style="padding: 8px 16px 4px 16px">
                        <div style="text-align:center;">地點/時間</div>
                    </section>

                    <section style="padding: 4px 16px; height: 38px;">
                        <input id="order_airport_address" placeholder="請輸入上車地址" type="text" class="text-input2" ng-model="order_airport_address" required>
                        <input type="button" value="上車記錄" class="btn btn-default submit_btn right_btn">
                    </section>

                    <section style="padding: 4px 16px; height: 38px;">
                        <input id="order_airport_destination" placeholder="桃園機場第一航廈" type="text" class="text-input2" ng-model="order_airport_destination" required>
                        <input type="button" onclick="openAirportSlot()" value="變更機場" class="btn btn-default submit_btn right_btn">
                    </section>

                    <section style="padding: 4px 16px;">
                        <input id="datepicker2" type="datetime-local" style="width:100%">
                    </section>

                    <section style="padding: 4px 16px" class="radio_box">
                        <input type="submit" value="搜尋" class="btn btn-default submit_btn">
                    </section>
                </form>
            </div>
            <!-- 機場共乘 end -->

            <!-- 一般共乘 begin -->
            <div id="normal" class="tab-pane fade in active">

                <form id="page2_order_form">

                    <section style="padding: 8px 16px 4px 16px">
                        <div style="text-align:center;">設定共乘條件</div>
                    </section>

                    <section style="padding: 4px 16px; height: 38px;">
                        <input id="order_address" onClick="addressClick()" placeholder="請定位上車地址" type="text" ng-model="order_address" class="text-input2" required>
                        <input value="上車記錄" onClick="addressRecordClick()" type="button" class="btn btn-default submit_btn right_btn">
                    </section>

                    <section style="padding: 4px 16px; height: 38px;">
                        <input id="order_destination" onClick="destinationClick()" placeholder="請定位下車地址" type="text" ng-model="order_destination" class="text-input2" required>
                        <input value="下車記錄" onClick="destinationRecordClick()" type="button" class="btn btn-default submit_btn right_btn">
                    </section>

                    <section style="padding: 4px 16px;">
                        <input id="datepicker" type="datetime-local" style="width:100%">
                    </section>

                    <hr>

                    <section style="padding: 0px 16px 4px 16px">
                        <div style="text-align:center;">聯繫/備註</div>
                    </section>

                    <section style="padding: 2px 16px 0 16px; display:inline-block; width:100%;">
                        <input value="0921960028" type="text" class="text-input" ng-model="phones" placeholder="請輸入手機號碼" id="phones" pattern="^09\d{8}$" style="width:49%; float:left; margin-right:1%;">
                        <input value="wonliao1117@gmail.com" type="text" class="text-input" ng-model="email" placeholder="請輸入電子信箱" id="email" style="width:49%; float:left; margin-left:1%;">
                    </section>
    
                    <section style="padding: 2px 16px 0 16px; display:inline-block; width:100%;">
                        <input id="purpose_destination" type="button" onclick="openPurposeSlot()" value="請選擇共乘目的" class="btn btn-default submit_btn left_btn" style="width:49%; float:left; margin-right:1%;">
                        <input id="purpose_note" type="text" class="text-input" ng-model="note" placeholder="其餘特殊需求備註" id="note" style="width:49%; float:left; margin-left:1%;">
                    </section>
    
                    <section style="padding: 2px 16px 0 16px; display:inline-block; width:100%;">
                        <input type="text" class="text-input" ng-model="purpose_other" placeholder="請輸入您的共乘目的" id="purpose_other" style="display:none;">
                    </section>

                    <div style="clear:both; height:5px"></div>
            
                    <section style="padding: 4px 16px" class="radio_box">
                        <input name="ck_1" type="checkbox" required/><span style="margin-left:5px"><span id="ck_1_span">我同意共乘車資依照跳錶金額平均分攤，並同意本活動之</span><a onClick="page7_click()" style="cursor: pointer;">服務條款</a>及<a onClick="page4_click()" style="cursor: pointer;">活動說明</a></span>
                    </section>

                    <section style="padding:16px" class="radio_box">                
                        <input type="submit" value="確定" class="btn btn-default submit_btn">
                    </section>
                    
                    
                    <div style="clear:both; height:500px"></div>
                </form>
                
                
            </div>
            <!-- 一般共乘 end -->
        </div>
    </div>

</ons-page>


    <ons-template id="alert-dialog.html">
        <ons-alert-dialog var="alertDialog">
            <div class="alert-dialog-title">
                <strong style="color: #ff3333" id="alertDialogTitle">定位失敗!</strong>    
            </div>
            <div class="alert-dialog-content">
                <span id="alertDialogText">請確定已開啟GPS功能，並重新嘗試。</span>
            </div>
            <div class="alert-dialog-footer">
                <button id="dialog_btn" class="alert-dialog-button" onClick="location.reload()">OK</button>
            </div>
        </ons-alert-dialog>
    </ons-template> 
    
<script>

    ons.ready(function() {

        setTimeout(function() {
            
           
            
   
            //window.localStorage.setItem("facebook_id", "1389354124412945");
            //window.localStorage.setItem("facebook_name", "廖志旺");
            
            hideFloatIcon();
            
           // $('.page__content').scrollTop(500);
            
            /*
            $("input").focus(function(){
                var screen_h = $(document).height();
               
                var _top = $(this).offset().top;
                
                var _top = screen_h * 0.6 + _top;
                
                console.log("won test ==> top("+_top+") screen_h("+screen_h+")");
                
                $('.page__content').scrollTop(_top);
            });
            */
            
            
           
            $("input").on('touchend', function(e){
               
                var screen_h = $(document).height();
                var _top = $(this).offset().top;
                console.log("won test 1 ==> top("+_top+") screen_h("+screen_h+")");
                
                //var _top = screen_h * 0.6 + _top;
                //console.log("won test 2 ==> top("+_top+")");
                
                $('.page__content').scrollTop(_top);
                
                event.preventDefault();
            });

            
            var tab_active = window.localStorage.getItem("tab_active");
            console.log("won test 1 ==> tab_active("+tab_active+")");
            if ( tab_active == "airport_tab" ) {
                
                $("#order_normal_tab").removeClass("active");
                $("#order_airport_tab").addClass("active");

                $("#purpose_destination").val("機場共乘").hide();
                $("#purpose_note").css("width", "100%").css("margin-left", "0");
                
            }
            window.localStorage.setItem("tab_active", "normal_tab");

            // 檢查 facebook 是否已登入
            if(window.localStorage.getItem("facebook_id") == "" || window.localStorage.getItem("facebook_id") == null ) {

                ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {
                    
                    $('#alertDialogTitle').html("提示");
                    $('#alertDialogText').html("請先登入您的Facebook帳號");
                    $(".alert-dialog-button").attr("onclick","needLogin()");
                    alertDialog.show();
                });

                return;
            }

            // 檢查是否被禁止刊登
            is_fb_player_enable();
            
            // 代入時間
            var _time = window.localStorage.getItem("page2_time");
            //console.log("won test 2 ==> _time("+_time+")");
            $('#datepicker').val(_time);
            $('#datepicker2').val(_time);

            if(window.localStorage.getItem("f1") != null && window.localStorage.getItem("f1") != "") {

                var f1 = window.localStorage.getItem("f1");
                var f2 = window.localStorage.getItem("f2");
                var f3 = window.localStorage.getItem("f3");
                var f4 = window.localStorage.getItem("f4");

                // 自動代入下車地點
                if(f1 != null && f1 != "null" && f1 != "") {

                    $('#order_destination').val(f1);//.focus();
                }

                // 自動代入備註
                if(f3 != null && f3 != "") {
    
                    $('#note').val(f3);//.focus();
                }

                // 自動代入共乘目的
                if(f4 != null && f4 != "") {
                    
                    $("#purpose_destination").val(f4);
                }            

                // 自動代入共乘時間
                if(f2 != null && f2 != "") {

                    var yyyy = f2.substring(0,4);
                    var MM = f2.substring(4,6);
                    var dd = f2.substring(6,8);
                    var hh = f2.substring(8,10);
                    var mm = f2.substring(10,12);
                    var now = new Date(yyyy,MM,dd,hh,mm,00);

                    var hours = (now.getHours()<10?'0':'') + now.getHours();
                    var minutes = (now.getMinutes()<10?'0':'') + now.getMinutes();
                    var _m = (now.getMonth()<10?'0':'') + now.getMonth();
                    var _d = (now.getDate()<10?'0':'') + now.getDate();
                    var today = now.getFullYear() + '-' + _m + '-' + _d + 'T' +  hours + ':' + minutes + ":00";
                    $('#datepicker').val(today);
                    $('#datepicker2').val(today);
                }
            } else {

                // 上下車地址
                var _address = window.localStorage.getItem("page2_address");
                var _destination = window.localStorage.getItem("page2_destination");
                console.log("won test 2 ==> _address("+_address+") _destination("+_destination+")");

                // 自動代入下車地點
                if(_address != null && _address != "null" && _address != "") {

                    $('#order_address').val(_address);//.focus();
                }
                
                // 自動代入下車地點
                if(_destination != null && _destination != "null" && _destination != "") {

                    $('#order_destination').val(_destination);//.focus();
                }
            }

            // 自動代入 phones
            var my_phones = window.localStorage.getItem("phones");
            if(my_phones != null && my_phones != "") {
                $('#phones').val(my_phones);//.focus();
            }

            // 自動代入 email
            var my_email = window.localStorage.getItem("email");
            if(my_email != null && my_email != "") {
                $('#email').val(my_email);//.focus();
            }

            $('#ck_1_span').click(function() {

                var ck_1 = $('input[name=ck_1]:checked');
                if(ck_1.length > 0)     $('input[name=ck_1]').prop("checked", false);
                else                    $('input[name=ck_1]').prop("checked", true);
            });

            isFirstTime = true;
            $('#page2_order_form').on('submit', function() {

                if(window.localStorage.getItem("facebook_id") == "" || window.localStorage.getItem("facebook_id") == null ) {

                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("提示");
                        $('#alertDialogText').html("請先登入您的Facebook帳號");
                        $("#dialog_btn").attr("onclick","needLogin()");
                        alertDialog.show();
                    });

                    return;
                }

                var _address = $('#order_address').val();             // 上車地址
                var _destination = $('#order_destination').val();     // 下車地址
                if(_address.length <= 0 || _destination.length <= 0) {
                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("資訊不完整");
                        $('#alertDialogText').html('請輸入完整上下車地址');
                        $("#dialog_btn").attr("onclick","closeDialog()");
                        alertDialog.show();
                    });
                    return false;
                }
               
                var _datepicker = $('#datepicker').val();        // 出發日期
                if(_datepicker.length <= 0) {

                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("資訊不完整");
                        $('#alertDialogText').html('請輸入出發日期(僅供30日內預約)');
                        $("#dialog_btn").attr("onclick","closeDialog()");
                        alertDialog.show();
                    });
                    return false;
                }

                var phones = $('#phones').val();        // 手機號碼
                var email = $('#email').val();          // 電子信箱
                if(phones.length <= 0 && email.length <= 0) {

                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("資訊不完整");
                        $('#alertDialogText').html('請輸入手機號碼或電子信箱');
                        $("#dialog_btn").attr("onclick","closeDialog()");
                        alertDialog.show();
                    });
                    return false;
                }

                if(phones.length > 0) {

                    if(phones[0] != 0 || phones[1] != 9 || phones.length < 10) {
    
                        ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                            $('#alertDialogTitle').html("資訊不完整");
                            $('#alertDialogText').html('手機號碼格式錯誤，請輸入手機號碼(10位數字)');
                            $("#dialog_btn").attr("onclick","closeDialog()");
                            alertDialog.show();
                        });
                        return false;
                    } else {
                        window.localStorage.setItem("phones", phones);
                    }
                }

                if(email.length > 0) {

                    var at = email.search("@");
                    if(at == -1) {

                         ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {
        
                            $('#alertDialogTitle').html("資訊不完整");
                            $('#alertDialogText').html('電子信箱格式錯誤，請輸入正確電子信箱');
                            $("#dialog_btn").attr("onclick","closeDialog()");
                            alertDialog.show();
                        });
                        return false;
                    } else {
                        window.localStorage.setItem("email", email);
                    }
                }

                var ck_1 = $('input[name=ck_1]:checked');
                var ck_3 = $("#purpose_destination").val();
                if(ck_3 == "") {

                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("資訊不完整");
                        $('#alertDialogText').html('請選擇您本次共乘目的');
                        $("#dialog_btn").attr("onclick","closeDialog()");
                        alertDialog.show();
                    });
                    return false;
                } else if(ck_1.length <= 0) {

                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("資訊不完整");
                        $('#alertDialogText').html('請勾選"我同意此次共乘車資，與共乘夥伴依照跳錶金額平均分攤"');
                        $("#dialog_btn").attr("onclick","closeDialog()");
                        alertDialog.show();
                    });
                    return false;
                }

                var address = $('#order_address').val();				    // 上車地點
                var destination = $('#order_destination').val();		    // 下車地點
                var startDate = $('#datepicker').val();			            // 出發日期
                var note = $('#note').val();						        // 備註
                var purpose = $('#purpose_destination').val();              // 共乘目的

                

                if(purpose == "其他") {

                    var purpose_other = $("#purpose_other").val();
                    if(purpose_other != "") {
                        
                        purpose = purpose_other;
                    } else {

                        ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                            $('#alertDialogTitle').html("資訊不完整");
                            $('#alertDialogText').html('請輸入您的共乘目的');
                            $("#dialog_btn").attr("onclick","closeDialog()");
                            alertDialog.show();
                        });
                        return false;
                    }
                } else if(purpose == "請選擇共乘目的") {
                    purpose = "";
                }
                
                console.log("won test 1 ==> note("+note+")");
                if (typeof note == 'undefined') {
                    note = ""
                }
                console.log("won test 2 ==> note("+note+")");
                
                $.getJSON('https://maps.googleapis.com/maps/api/geocode/json', {
            		key: 'AIzaSyAHgoUk-vzZfk0CPhkOBNsX5fTyrCKVkh8',
        			address: destination	// 下車地點
        		}, function(data2) {
        			
                    if(data2.results.length <= 0) {

                        ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                            $('#alertDialogTitle').html("資訊不完整");
                            $('#alertDialogText').html("請輸入完整下車地址");
                            $("#dialog_btn").attr("onclick","closeDialog()");
                            alertDialog.show();
                        });
                        return;
                    }

            		var c, point_of_interest, area = {
        				name: destination,		// 下車地點
                        latitude: "",
                        longitude: ""
        			};
                    
                    if(data2.results[0]) {

                        area.d_latitude = data2.results[0].geometry.location.lat;
                        area.d_longitude = data2.results[0].geometry.location.lng;
                    }
                 
            		$.getJSON('https://maps.googleapis.com/maps/api/geocode/json', {
            			key: 'AIzaSyAHgoUk-vzZfk0CPhkOBNsX5fTyrCKVkh8',
            			address: address	// 上車地點
            		}, function(data) {
            			
                        if(data.results.length <= 0) {
    
                            ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                                $('#alertDialogTitle').html("資訊不完整");
                                $('#alertDialogText').html("請輸入完整上車地址");
                                $("#dialog_btn").attr("onclick","closeDialog()");
                                alertDialog.show();
                            });
                            return;
                        }

                        if(data.results[0]) {
                            area.latitude = data.results[0].geometry.location.lat;
                            area.longitude = data.results[0].geometry.location.lng;
                        }
                        
            			//get address, city and state
            			for (var i = 0; i < data.results[0].address_components.length; i++) {
            				c = data.results[0].address_components[i];
            				if (!c.types.length || c.types[0] == 'point_of_interest') {
            					point_of_interest = c.short_name;
            				} else if (c.types.indexOf('street_number') !== -1) {
            					area.address = c.long_name;
            				} else if (c.types.indexOf('route') !== -1) {
            					area.address += ' ' + c.long_name;
            					area.address = area.address.trim();
            				} else if (c.types.indexOf('locality') !== -1) {
            					area.city = c.long_name;
            				} else if (c.types.indexOf('sublocality') !== -1) {
            					if (!area.city) area.city = c.long_name;
            				} else if (c.types.indexOf('administrative_area_level_3') !== -1) {
            					if (!area.city) area.city = c.long_name;
            				} else if (c.types.indexOf('administrative_area_level_1') !== -1) {
            					area.state = c.short_name;
            				} else if (c.types.indexOf('postal_code') !== -1) {
            					area.postal_code = c.short_name;
            				} else if (c.types.indexOf('country') !== -1) {
            					area.country = c.short_name;
            				}
            			}
    
            			// facebook user id
            			area.fb_id = window.localStorage.getItem("facebook_id");
                        area.fb_name = window.localStorage.getItem("facebook_name");
                        area.fb_mail = window.localStorage.getItem("facebook_mail");
                        
            			area.input_address = address;		// 上車地點
            			area.destination = destination;	    // 下車地點
            			area.phones = phones;				// 手機號碼
                        area.email = email;    			    // 電子信箱
                        area.note = note;					// 備註
                        area.purpose = purpose;			    // 共乘目的

                        // 建立時間
                        var d = new Date();
                        area.timestamp = d.getTime();

                        startDate = startDate.replace(/-/g, "/");
                        startDate = startDate.replace(/T/," ");
                        var d = new Date(startDate);

                        start_time_txt = d.toLocaleTimeString();

                        var now_d = new Date();
                        if(now_d.getTime() > d.getTime()) {
                            
                            ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {
        
                                $("#datepicker").css("border-color", "#F00");
                                $("#timepicker").css("border-color", "#F00");

                                $('#alertDialogTitle').html("資訊不完整");
                                $('#alertDialogText').html("出發日期及時間不得小於目前時間，請重新輸入");
                                $("#dialog_btn").attr("onclick","closeDialog()");
                                alertDialog.show();
                            });

                            return false;
                        } else {

                            $("#datepicker").css("border-color", "#AAA");
                            $("#timepicker").css("border-color", "#AAA");
                        }
                        
                        // 預約時間
                        area.appointment = d.getTime();
    
                        // 過期時間 = 預約時間 + 10分鐘
                        d.setMinutes(d.getMinutes() + 10);
            			area.expired_time = d.getTime();
                        
                        // 排序用
                        area.priority = 0 - Math.floor( d.getTime() + d.getMilliseconds() + i );
                        area.status = "";
    
            			if (!area.address && point_of_interest) area.address = point_of_interest;
    
            			//persist to firebase
            			var area_id = firebase.database().ref().child('areas').push().key;
            			var updates = {};
                        console.log(area);
            			updates['/areas/' + area_id] = area;
                        firebase.database().ref().update(updates);
    
            			//geofire
            			geoFire.set(area_id, [area.latitude, area.longitude]).then(function() {
            				//console.log(area_id + ': setting position to [' + area.latitude + ',' + area.longitude + ']');
            			});
    
                        var _latlng = area.latitude + "," + area.longitude;
                        window.localStorage.setItem("marker_center", _latlng);

            			//clean up form
            			$('form#add').trigger('reset');
    
                        ga('send', 'event', '刊登共乘頁', '上車地點', area.state + area.city);
                        ga('send', 'event', '刊登共乘頁', '上車詳細地點', area.input_address);
                        ga('send', 'event', '刊登共乘頁', '下車地點', area.destination);
                        ga('send', 'event', '刊登共乘頁', '出發時間', start_time_txt);
                        ga('send', 'event', '刊登共乘頁', '共乘目的', area.purpose);
     
                        var to = area.email;
                		var subject = "刊登成功通知！- go2gether大車隊共乘";
            			var body = area.fb_name + " 小姐/先生<br><br>";
            			body += "感謝您使用go2gether大車隊共乘。<br>";
            			body += "您的刊登需求已經成功上架於網站首頁囉！<br>";
            			body += "<br>";
            			body += "刊登詳情如下：<br>";
            			body += "上車地點："+area.input_address+"<br>";
            			body += "下車地點："+area.destination+"<br />";
            			body += "出發日期："+startDate+"<br>";
            			body += "出發時間："+start_time_txt+"<br>";
            			
            			if(area.note != "")     { body += "備註："+area.note+"<br>";	    }
            			if(area.phones != "")   { body += "手機號碼："+area.phones+"<br>";	}
            			if(area.email != "")    { body += "電子信箱："+area.email+"<br>";	}
            			
            			body += "<br>";
            			body += "當您收到此封系統通知信件後，將可於共乘網站的首頁，找到您的共乘需求圖標（顯示為黃色圖標）。<br>";
            			body += "<br>";
            			body += "在等候夥伴聯繫您的同時，您也可進行以下動作：<br />";
            			body += "1. 資訊確認：回到共乘網站首頁，確認你的刊登資訊是否正確。<br />";
            			body += "2. 夥伴聯繫：隨時注意來自夥伴的 電話/簡訊/email 聯繫訊息。<br />";
            			body += "3. 查詢記錄：點選右上角側邊欄，選擇「刊登紀錄」，查看所有刊登過的需求。<br />";
            			body += "4. 準時出發：當共乘夥伴主動聯繫並約好碰面後，請記得準時到達預定的上車地點。<br />";
            			body += "5. 再次刊登：把下次要共乘的需求，前往完成吧！<br />";
            			body += "   ＊go2gether大車隊共乘：<a href='https://goo.gl/gje0G6'>https://goo.gl/gje0G6</a><br />";
            			body += "6. 提前於手機下載55688APP，讓您出門更加便利！<br />";
            			body += "   ＊下載教學：<a href='http://app.taiwantaxi.com.tw/APPS/Mobile/Intro.aspx'>http://app.taiwantaxi.com.tw/APPS/Mobile/Intro.aspx</a><br />";
            			body += "<br />";
            			body += "<br />";
            			body += "如果您有任何疑問，請隨時聯繫我們。<br />";
            			body += "感謝您使用go2gether大車隊共乘<br />";
            			body += "活動網站：<a href='https://goo.gl/gje0G6'>https://goo.gl/gje0G6</a><br />";
            			body += "官方粉絲團：<a href='https://goo.gl/cVIwMp'>https://goo.gl/cVIwMp</a><br />";
            			body += "<br />";
     
                        $.post("https://17-vr-live.wonliao.com/go2gether/www/backend/send_mail.php", 
                        	{ 
                    			"to": to,
                    			"subject": subject,
                                "body": body
                    		}
                    	);
                        
                        // 清除暫存資訊
                        window.localStorage.setItem("f1", "");
                        window.localStorage.setItem("f2", "");
                        window.localStorage.setItem("f3", "");
                        window.localStorage.setItem("f4", "");
                        window.localStorage.setItem("page2_address", "");
                        window.localStorage.setItem("page2_destination", "");
                        
                        // 跳至完成刊登頁
                        homeNavigator.pushPage("page2_success.html?t=1213", {animation: 'slide'});    
            		});
                });

                return false;
            });
        }, 10);
    });

    function stringToDate(_date,_format,_delimiter) {

        var formatLowerCase=_format.toLowerCase();
        var formatItems=formatLowerCase.split(_delimiter);
        var dateItems=_date.split(_delimiter);
        var monthIndex=formatItems.indexOf("mm");
        var dayIndex=formatItems.indexOf("dd");
        var yearIndex=formatItems.indexOf("yyyy");
        var month=parseInt(dateItems[monthIndex]);
        month-=1;
        var formatedDate = new Date(dateItems[yearIndex],month,dateItems[dayIndex]);
        return formatedDate;
    }

    function is_fb_player_enable() {

        var key = window.localStorage.getItem("facebook_id");
        players.child(key).once('value', function(snapshot) {

            if(snapshot.exists() == true) {

                var enable = snapshot.val().enable;
                if(enable != true) {

                    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {

                        $('#alertDialogTitle').html("提示");
                        $('#alertDialogText').html("帳號因違反使用者規範，詳細請洽客服");
                        $("#dialog_btn").attr("onclick","reload()");
                        alertDialog.show();
                    });
                }
            }
        });
    }

    function page7_click() {

        homeNavigator.pushPage("page7.html", {animation: 'slide'});
    }

    function page4_click() {

        tabbar.setActiveTab(3);
    }

    function closeDialog() {

        alertDialog.destroy();
    }
    
    function addressClick() {

        window.localStorage.setItem("select_map", "address");
        homeNavigator.pushPage("select_map.html", {animation: 'slide'});
    }
    
    function destinationClick() {

        window.localStorage.setItem("select_map", "destination");
        homeNavigator.pushPage("select_map.html", {animation: 'slide'});
    }
    
    function addressRecordClick() {

        homeNavigator.pushPage("page2_list.html", {animation: 'slide'});
    }
    
    function destinationRecordClick() {

        homeNavigator.pushPage("page2_list.html", {animation: 'slide'});
    }
    
    function showRecord() {
        
        homeNavigator.pushPage("record.html", {animation: 'slide'});
    }

    function cancel() {
        console.log("SpinningWheel Cancel")
    }

    // 機場選擇器
    function openAirportSlot() {

        var airports = {};
        airports[0] = "桃園機場第一航廈";
        airports[1] = "桃園機場第二航廈";
        airports[2] = "臺北松山機場";
        airports[3] = "臺中清泉崗機場";
        airports[4] = "臺南機場";
        airports[5] = "高雄小港機場";
        airports[6] = "花蓮機場";

        if(SpinningWheel.isExist())	SpinningWheel.destroy();
        SpinningWheel.addSlot(airports, 'center', 1);
        SpinningWheel.setCancelAction(cancel);
        SpinningWheel.setDoneAction(airportDone);
        SpinningWheel.open();
    }

    function airportDone() {

        var results = SpinningWheel.getSelectedValues();
        console.log("SpinningWheel results(" + results.values.join(':') + ")");

        $("#order_airport_destination").val(results.values.join(':'));
    }

    // 共乘目的
    function openPurposeSlot() {

        var purposes = {};
        purposes[0] = "球賽共乘";
        purposes[1] = "通勤";
        purposes[2] = "認識朋友";
        purposes[4] = "其他";

        if(SpinningWheel.isExist())    SpinningWheel.destroy();
        SpinningWheel.addSlot(purposes, 'center', 1);
        SpinningWheel.setCancelAction(cancel);
        SpinningWheel.setDoneAction(purposeDone);
        SpinningWheel.open();
    }

    function purposeDone() {

        var results = SpinningWheel.getSelectedValues();
        var result_string = results.values.join(':');
        console.log("SpinningWheel results(" + result_string + ")");

        $("#purpose_destination").val(result_string);
        
        if(result_string == "其他") {
            $('#purpose_other').show();   
        } else {
            $('#purpose_other').hide();
        }
    }
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84401162-1', 'auto');
  ga('send', 'pageview', '刊登共乘頁-刊登');
</script>