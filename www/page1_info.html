<style>
#fb_user_picture {
    -webkit-border-radius: 60px;
    -moz-border-radius: 60px;
    border-radius: 60px;
    BORDER: #c9c9c9 2px solid;
}
</style>

<ons-page style="background:#fff;">

    <ons-toolbar>
        <div class="left" style="line-height: 44px;">
            <ons-back-button></ons-back-button>
        </div>
        <div class="center">
            <img src="images/go2gether.png" style="height:32px;"/>
        </div>
        <div class="right" style="line-height: 44px">
            <ons-toolbar-button ng-click="menu.toggleMenu()">
        		<ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>
    		</ons-toolbar-button>
        </div>
    </ons-toolbar>
        
        <div style="clear:both; height:10px"></div>

        <!-- facebook 頭像及名稱 -->
        <section style="padding: 4px 16px; text-align:center;">
            <img id="fb_user_picture"/>
            <div id="fb_user_name"></div>
        </section>
        
        <div style="clear:both; height:10px"></div>
         
        <section class="section1">
            <div style="color:#b5b2b2;">上車地點</div>
            <div id="input_address_div" style="color:#6b6b6b;"></div>
        </section>
        
        <section class="section1">
            <div style="color:#b5b2b2;">下車地點</div>
            <div id="destination_div" style="color:#6b6b6b;"></div>
        </section>
        
        <section class="section1">
            <div style="color:#b5b2b2;">出發時間</div>
            <div id="time_div" style="color:#6b6b6b;"></div>
        </section>
        
        <section class="section1">
            <div style="color:#b5b2b2;">共乘目的</div>
            <div id="purpose_div" style="color:#6b6b6b;"></div>
        </section>
        
        <section class="section1">
            <div style="color:#b5b2b2;">備註</div>
            <div id="note_div" style="color:#6b6b6b;"></div>
        </section>

        <div style="clear:both; height:10px"></div>
         
        <section style="padding: 4px 16px; text-align:center;">
            <ons-button class="button button--large" modifier="chevron" onclick="contact_btn()" style="background:#36d0c9; border-radius:0;">
                <span style="font-size:18px">聯繫對方</span>
            </ons-button>
        </section>
        
</ons-page>
    
    <ons-template id="alert-dialog.html">
      <ons-alert-dialog var="alertDialog">
        
        <div class="alert-dialog-content">
            活動尚未開放
        </div>
        <div class="alert-dialog-footer">
          <button class="alert-dialog-button" onClick="alertDialog.hide()">OK</button>
        </div>
      </ons-alert-dialog>
    </ons-template>

<script>

    ons.ready(function() {
        setTimeout(function() {

            showInfo();
        }, 10);
    });
    

    var fb_id = "";
    var phones = "";
    function showInfo() {
        
        //var key = "-KRRNVxXNetIAj6aXiZL";
        var key = window.localStorage.getItem("info_key");
        
        areas.child(key).on('value', function(snapshot) {
    					
			//console.log(snapshot.val());
			fb_id = snapshot.val().fb_id;                       // facebook user id
            var fb_name = snapshot.val().fb_name;               // facebook user name
            var input_address = snapshot.val().input_address;   // 上車地點
            var destination = snapshot.val().destination;       // 下車地點
			var timestamp = snapshot.val().timestamp;		    // 共乘時間
			var purpose = snapshot.val().purpose;			    // 共乘目的
            var note = snapshot.val().note;    		            // 備註
            phones = snapshot.val().phones;        	        // 手機

			var d = new Date(timestamp);
			var time_text = d.toLocaleString();
		    
            var fb_image = "https://graph.facebook.com/"+fb_id+"/picture?type=normal";
            //console.log("fb_image("+fb_image+")");
            $('#fb_user_picture').attr("src", fb_image);
			$('#fb_user_name').text(fb_name);			
            $('#input_address_div').text(input_address);
            $('#destination_div').text(destination);
            $('#time_div').text(time_text);
            $('#purpose_div').text(purpose);
            $('#note_div').text(note);
		});
    }
    
    function contact_btn() {
        
        var message = "";
            message +=  '<div class="pop_message">';
            message +=  '<section class="section1">';
            message +=      '<ons-button class="button button--large" modifier="chevron" onclick="fb_messenger_btn()" style="background:#36d0c9; border-radius:0;">';
            message +=          '<span style="font-size:18px">Facebook messenger 聯繫</span>';
            message +=      '</ons-button>';
            message +=  '</section>';
            
            message +=  '<section class="section1">';
            message +=      '<ons-button class="button button--large" modifier="chevron" onclick="phone_click()" style="background:#36d0c9; border-radius:0;">';
            message +=          '<span style="font-size:18px">電話聯繫</span>';
            message +=      '</ons-button>';
            message +=  '</section>';
            
            message +=  '<section class="section1">';
            message +=      '<ons-button class="button button--large" modifier="chevron" onclick="HoldOn.close()" style="background:#adadad; border-radius:0;">';
            message +=          '<span style="font-size:18px">取消</span>';
            message +=      '</ons-button>';
            message +=  '</section>';
            message +=  '</div>';
            
        options = {
            theme: "custom",
            message: message,
            textColor: "white"
        };
            
        HoldOn.open(options);
    }
    
    function fb_messenger_btn() {
        window.location = "https://m.me/" + fb_id;
    }
    
    function phone_click() {
        window.location = "tel:" + phones;
    }
</script>