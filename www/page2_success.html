<style>
</style>

<ons-navigator title="Navigator" var="homeNavigator">
    <ons-page style="background:#fff;">
    
        <ons-toolbar fixed-style>
            <div class="left" style="line-height: 44px;">
                <ons-back-button></ons-back-button>
            </div>
            <div class="center">
                <img src="images/go2gether.png" style="height:32px;"/>
            </div>
            <div class="right" style="line-height: 44px">
                <ons-toolbar-button ng-click="menu.toggleMenu()">
                	<ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>
        		</ons-toolbar-button>
            </div>
        </ons-toolbar>
        
        
        <section style="background:#a7f5e8; margin:16px 16px 0 16px;">
            <section style="padding: 4px 16px 0 16px; text-align:center;">
                <h1 style="color:#F00; font-weight:bold;">恭喜完成刊登</h1>
            </section>
            <section style="padding: 0px; text-align:center; font-size:12px;">
                <div style="color:#000;">您達成了愛護地球的使命1次</div>
                <div style="color:#000;">接下來您可以…</div>
            </section>
            <section style="padding: 16px 4px 16px 4px; text-align:left; font-size:16px;">
                <div style="color:#000; padding-left:16px;">1.回到<a href="" onClick="page1Click()">首頁</a>，確認你的刊登資訊</div>
                <div style="color:#000; padding-left:16px;">2.隨時注意來自夥伴的 電話/簡訊/Email 聯繫訊息</div>
                <div style="color:#000; padding-left:16px;">3.點選右上角側邊欄，查看<a href="" onClick="page6Click()">共乘記錄</a></div>
            </section>
        </section>

        <div style="clear:both; height:10px"></div>

        <section style="margin:16px 16px 0 16px; padding: 16px 0px; border:1px #000 solid; border-radius:10px;">
            
            <section style="padding: 4px 16px 0 16px; text-align:center;">
                <div style="color:#000; font-weight:bold; font-size:18px;">別忘了領取刊登好禮!</div>
            </section>
            
            <section style="padding: 4px 12px; text-align:LEFT; font-size:16px;">
                <div style="color:#000; padding-left:16px;">*每個帳號各個獎項僅限領取一次</div>
                <div style="color:#000; padding-left:16px;">*查詢序號開啟右上角選單確認</div>
                <div style="color:#000; padding-left:16px;">*詳細活動內容請至<a href="" onClick="page5Click()">官方粉絲團查詢</a></div>
            </section>
            
            <!--
            <section style="padding: 4px 16px; text-align:center;">
                <div style="background:#acf2ff; height:110px">
                    <div style="line-height:55px;">KKBOX 免費試聽5日序號</div>
                    <ons-button id="kkbox_btn" class="button button--large" modifier="chevron" onclick="page2SuccessClick('KKBOX 免費試聽5日序號')" style="width:90%; margin:0 5%; background:#5bd4ea; border-radius:10px;">
                        <span id="kkbox_btn_text" style="font-size:18px">立即領取</span>
                    </ons-button>
                </div>
            </section>
            
            <section style="padding: 4px 16px; text-align:center;">
                <div style="background:#acf2ff; height:110px">
                    <div style="line-height:55px;">ZONE 免費電話點數500點</div>
                    <ons-button id="zone_btn" class="button button--large" modifier="chevron" onclick="page2SuccessClick('ZONE 免費電話點數500點')" style="width:90%; margin:0 5%; background:#5bd4ea; border-radius:10px;">
                        <span id="zone_btn_text" style="font-size:18px">立即領取</span>
                    </ons-button>
                </div>
            </section>
            -->
            <!--
            <section style="padding: 4px 12px; text-align:center;">
                <div id="kktv_bg_div" style="background:#f0f0f0; height:110px">
                    <div style="line-height:30px;">KKTV 追劇神器免費體驗7日(兌換至106/2/3)</div>
                    <a id="kktv_link" href="https://app.kktv.me/redeem" target="_blank" style="line-height:30px; display:none">點我前往兌換</a>
                    <ons-button id="kktv_btn" class="button button--large" modifier="chevron" onclick="page2SuccessClick('KKTV 追劇神器免費體驗7日')" style="width:90%; margin:0 5%; background:#5bd4ea; border-radius:10px;">
                        <span id="kktv_btn_text" style="font-size:18px">立即領取</span>
                    </ons-button>
                </div>
            </section>
            -->
            <section style="padding: 4px 12px; text-align:center;">
                <div style="background:#f0f0f0; height:110px">
                    <div id="amart_text" style="line-height:30px;">愛買線上購物 100元購物金</div>
                    <a id="amart_link" href="http://www.gohappy.com.tw/event/go2gether201610_facility" target="_blank" style="line-height:30px; display:none">點我前往兌換</a>
                    <ons-button id="amart_btn" class="button button--large" modifier="chevron" onclick="page2SuccessClick('愛買線上購物 100元購物金')" style="width:90%; margin:0 5%; background:#5bd4ea; border-radius:10px;">
                        <span id="amart_btn_text" style="font-size:18px">立即領取</span>
                    </ons-button>
                </div>
            </section>

            <section style="padding: 4px 12px; text-align:center;">
                <div id="omusic_bg_div" style="background:#f0f0f0; height:110px">
                    <div style="line-height:30px;">Omusic 百萬音樂免費體驗10日(兌換至106/2/28)</div>
                    <a id="omusic_link" href="http://goo.gl/ISf55o" target="_blank" style="line-height:30px; display:none">點我前往兌換</a>
                    <ons-button id="omusic_btn" class="button button--large" modifier="chevron" onclick="page2SuccessClick('Omusic 百萬音樂免費體驗10日')" style="width:90%; margin:0 5%; background:#5bd4ea; border-radius:10px;">
                        <span id="omusic_btn_text" style="font-size:18px">立即領取</span>
                    </ons-button>
                </div>
            </section>
        
            <div style="clear:both; height:10px"></div>
             
            <section style="padding: 4px 16px; text-align:center;">
                <ons-button class="button button--large" modifier="chevron" onclick="page2SuccessClick('確定')" style="background:#36d0c9; border-radius:0;">
                    <span style="font-size:18px">確定</span>
                </ons-button>
            </section>

        </section>
        
        <div style="clear:both; height:16px"></div>

    </ons-page>
    
    <ons-template id="alert-dialog.html">
      <ons-alert-dialog var="alertDialog">
        <div class="alert-dialog-content">
             <span id="page2SuccessAlertDialogText"></span>
        </div>
        <div class="alert-dialog-footer">
          <button class="alert-dialog-button" onClick="alertDialog.destroy()">OK</button>
        </div>
      </ons-alert-dialog>
    </ons-template>

</ons-navigator>

<script>

ons.ready(function() {
    setTimeout(function() {

        //window.localStorage.setItem("facebook_id", "1389354124412945");
        //window.localStorage.setItem("facebook_name", "廖志旺");
            
        //var kktv_serial_number = window.localStorage.getItem("kktv");
        var amart_serial_number = window.localStorage.getItem("amart");
        var omusic_serial_number = window.localStorage.getItem("omusic");

        var omusic_count = Math.floor(window.localStorage.getItem("omusic_count"));
        if(omusic_count == "" || omusic_count == null)  omusic_count = 0;
        omusic_count += 1;
        window.localStorage.setItem("omusic_count", omusic_count); 
        /*
        if(kktv_serial_number != "" && kktv_serial_number != null) {
        
            $("#kktv_btn").attr("disabled", true);
            $("#kktv_btn_text").css("color", "#000").text(kktv_serial_number);
            $("#kktv_link").show();
            $("#kktv_bg_div").css("height", "145px");
        }
        */
        if(amart_serial_number != "" && amart_serial_number != null) {
        
            $("#amart_btn").attr("disabled", true);
            $("#amart_btn_text").css("color", "#000").text(amart_serial_number);
            $("#amart_link").show();
        }

        if(omusic_serial_number != "" && omusic_serial_number != null ) {

            $("#omusic_btn").attr("disabled", true);
            $("#omusic_btn_text").css("color", "#000").text(omusic_serial_number);
            $("#omusic_link").show();
            $("#omusic_bg_div").css("height", "145px");
        } else if(omusic_count < 5){

            $("#omusic_btn").attr("disabled", true);
            $("#omusic_btn_text").css("color", "#000").text("刊登5次即可領取(" + omusic_count + "/5)");
        }
    }, 10);
});
    
function page2SuccessClick(pageName) {
    
    switch(pageName) {
    //case "KKTV 追劇神器免費體驗7日":    serial_number("kktv", pageName);            break;
    case "KKBOX 免費試聽5日序號":       serial_number("kkbox", pageName);           break;
    case "ZONE 免費電話點數500點":      serial_number("zone", pageName);            break;
    case "愛買線上購物 100元購物金":    serial_number("amart", pageName);           break;
    case "Omusic 百萬音樂免費體驗10日": serial_number("omusic", pageName);          break;
    case "確定":                        submit_btn();                               break;
    }

    ga('send', 'event', '刊登完成頁', 'click', pageName);
}

function serial_number(event_name, pageName) {

    var facebook_id = window.localStorage.getItem("facebook_id");
    $.post("https://17-vr-live.wonliao.com/go2gether/www/backend/get_serial_number.php", 
    	{ 
			"fb_id": facebook_id,
			"event_name":	event_name
		}, function(res){

            console.log("flag("+res.flag+")");
			console.log("data("+res.data+")");

            window.localStorage.setItem(event_name, res.data);

            ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {
    
                //$("#kktv_btn").attr("disabled", true);
                $("#amart_btn").attr("disabled", true);
                $("#omusic_btn").attr("disabled", true);

                var text = "";
                text += "<h4>"+pageName+"</h4>";
                text += "<h4>序號</h4>";
                text += "<h4>"+res.data+"</h4>";
                $("#page2SuccessAlertDialogText").html(text);

                $("#"+event_name+"_btn").attr("disabled", true);
                $("#"+event_name+"_btn_text").css("color", "#000").text(res.data);
                $("#"+event_name+"_link").show();
                $("#"+event_name+"_bg_div").css("height", "145px");
                $("#"+event_name+"_text").css("line-height", "30px");

                ga('send', 'event', '領取序號', pageName, facebook_id);

                alertDialog.show();
            });
		},
		"json"
	);
}

/*
function get_gift() {

    ons.createAlertDialog('alert-dialog.html').then(function(alertDialog) {
        alertDialog.show();
    });  
}
*/

function submit_btn() {
    
    gotoPage1();
}

function page1Click() {
    gotoPage1();
}

function page5Click() {
    window.open("https://goo.gl/rj3XrB");
}

function page6Click() {
    homeNavigator.pushPage('page6.html', {animation: 'slide'});
}

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84401162-1', 'auto');
  ga('send', 'pageview', '刊登完成頁');
</script>